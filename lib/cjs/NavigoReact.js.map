{"version":3,"sources":["../../src/NavigoReact.tsx"],"names":["router","Context","React","createContext","match","SwitchContext","isInSwitch","switchMatch","getRouter","root","Navigo","strategy","noMatchWarning","window","nextTick","callback","setTimeout","configureRouter","reset","destroy","undefined","Route","path","children","loose","before","after","already","leave","state","action","context","setContext","switchContext","renderChild","noneBlockingHook","func","result","blockingHook","done","isMounted","handler","updatePageLinks","on","navigoRoute","getRoute","addBeforeHook","addAfterHook","addAlreadyHook","addLeaveHook","resolve","off","route","Base","Switch","setMatch","switchHandler","url","Date","getTime","NotFound","hooks","useNotFound","Redirect","navigate","useNavigo","useLocation","getCurrentLocation","notFound","current","API"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;AAKA,IAAIA,MAAJ;;AACA,IAAIC,OAAO,GAAGC,kBAAMC,aAAN,CAAoB;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAApB,CAAd;;AACA,IAAIC,aAAa,GAAGH,kBAAMC,aAAN,CAAoB;AAAEG,EAAAA,UAAU,EAAE,KAAd;AAAqBC,EAAAA,WAAW,EAAE;AAAlC,CAApB,CAApB,C,CAEA;;;AAIO,SAASC,SAAT,CAAmBC,IAAnB,EAA0C;AAC/C,MAAIT,MAAJ,EAAY;AACV,WAAOA,MAAP;AACD;;AACDA,EAAAA,MAAM,GAAG,IAAIU,kBAAJ,CAAWD,IAAI,IAAI,GAAnB,EAAwB;AAAEE,IAAAA,QAAQ,EAAE,KAAZ;AAAmBC,IAAAA,cAAc,EAAE;AAAnC,GAAxB,CAAT,CAJ+C,CAK/C;;AACAC,EAAAA,MAAM,CAACb,MAAP,GAAgBA,MAAhB;AACA,SAAOA,MAAP;AACD;;AACD,SAASc,QAAT,CAAkBC,QAAlB,EAAsC;AACpCC,EAAAA,UAAU,CAAC;AAAA,WAAMD,QAAQ,EAAd;AAAA,GAAD,EAAmB,CAAnB,CAAV;AACD,C,CAED;;;AACO,SAASE,eAAT,CAAyBR,IAAzB,EAAuC;AAC5C,SAAOD,SAAS,CAACC,IAAD,CAAhB;AACD;;AACM,SAASS,KAAT,GAAiB;AACtB,MAAIlB,MAAJ,EAAY;AACVA,IAAAA,MAAM,CAACmB,OAAP;AACAnB,IAAAA,MAAM,GAAGoB,SAAT;AACD;AACF,C,CAED;;;AACO,SAASC,KAAT,OAAqF;AAAA,MAApEC,IAAoE,QAApEA,IAAoE;AAAA,MAA9DC,QAA8D,QAA9DA,QAA8D;AAAA,MAApDC,KAAoD,QAApDA,KAAoD;AAAA,MAA7CC,MAA6C,QAA7CA,MAA6C;AAAA,MAArCC,KAAqC,QAArCA,KAAqC;AAAA,MAA9BC,OAA8B,QAA9BA,OAA8B;AAAA,MAArBC,KAAqB,QAArBA,KAAqB;;AAAA,oBAC5D,uBAAW,UAACC,KAAD,EAAuBC,MAAvB;AAAA,2CAAuDD,KAAvD,GAAiEC,MAAjE;AAAA,GAAX,EAAuF;AACnH1B,IAAAA,KAAK,EAAE;AAD4G,GAAvF,CAD4D;AAAA;AAAA,MACnF2B,OADmF;AAAA,MAC1EC,UAD0E;;AAI1F,MAAMC,aAAa,GAAG,uBAAW5B,aAAX,CAAtB;;AACA,MAAM6B,WAAW,GAAG,SAAdA,WAAc;AAAA,wBAAM,gCAAC,OAAD,CAAS,QAAT;AAAkB,MAAA,KAAK,EAAEH;AAAzB,OAAmCR,QAAnC,CAAN;AAAA,GAApB;;AACA,MAAMY,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,IAAD;AAAA,WAAoB,UAAChC,KAAD,EAAkB;AAC7DgC,MAAAA,IAAI,CAAC,UAACC,MAAD,EAAiB;AACpB,YAAI,yBAAOA,MAAP,MAAkB,QAAlB,IAA8BA,MAAM,KAAK,IAA7C,EAAmD;AACjDL,UAAAA,UAAU,CAACK,MAAD,CAAV;AACD;AACF,OAJG,EAIDjC,KAJC,CAAJ;AAKD,KANwB;AAAA,GAAzB;;AAOA,MAAMkC,YAAY,GAAG,SAAfA,YAAe,CAACF,IAAD;AAAA,WAAoB,UAACG,IAAD,EAAiBnC,KAAjB,EAAkC;AACzEgC,MAAAA,IAAI,CAAC,UAACC,MAAD,EAAiB;AACpB,YAAI,OAAOA,MAAP,KAAkB,SAAtB,EAAiC;AAC/BE,UAAAA,IAAI,CAACF,MAAD,CAAJ;AACD,SAFD,MAEO,IAAI,yBAAOA,MAAP,MAAkB,QAAlB,IAA8BA,MAAM,KAAK,IAA7C,EAAmD;AACxDL,UAAAA,UAAU,CAACK,MAAD,CAAV;AACD;AACF,OANG,EAMDjC,KANC,CAAJ;AAOD,KARoB;AAAA,GAArB;;AAUA,wBAAU,YAAM;AACd,QAAIoC,SAAS,GAAG,IAAhB;AACA,QAAMxC,MAAM,GAAGQ,SAAS,EAAxB;;AACA,QAAMiC,OAAO,GAAG,SAAVA,OAAU,CAACrC,KAAD,EAA0B;AACxC,UAAIoC,SAAJ,EAAe;AACbR,QAAAA,UAAU,CAAC;AAAE5B,UAAAA,KAAK,EAALA;AAAF,SAAD,CAAV;AACD;;AACDU,MAAAA,QAAQ,CAAC;AAAA,eAAMN,SAAS,GAAGkC,eAAZ,EAAN;AAAA,OAAD,CAAR;AACD,KALD,CAHc,CASd;;;AACA1C,IAAAA,MAAM,CAAC2C,EAAP,CAAUrB,IAAV,EAAgBmB,OAAhB;AACA,QAAMG,WAAW,GAAG5C,MAAM,CAAC6C,QAAP,CAAgBJ,OAAhB,CAApB,CAXc,CAYd;;AACA,QAAIhB,MAAJ,EAAY;AACVzB,MAAAA,MAAM,CAAC8C,aAAP,CAAqBF,WAArB,EAAiDN,YAAY,CAACb,MAAD,CAA7D;AACD;;AACD,QAAIC,KAAJ,EAAW;AACT1B,MAAAA,MAAM,CAAC+C,YAAP,CAAoBH,WAApB,EAAgDT,gBAAgB,CAACT,KAAD,CAAhE;AACD;;AACD,QAAIC,OAAJ,EAAa;AACX3B,MAAAA,MAAM,CAACgD,cAAP,CAAsBJ,WAAtB,EAAkDT,gBAAgB,CAACR,OAAD,CAAlE;AACD;;AACD,QAAIC,KAAJ,EAAW;AACT5B,MAAAA,MAAM,CAACiD,YAAP,CAAoBL,WAApB,EAAgDN,YAAY,CAACV,KAAD,CAA5D;AACD,KAxBa,CAyBd;;;AACA5B,IAAAA,MAAM,CAACiD,YAAP,CAAoBL,WAApB,EAAgD,UAACL,IAAD,EAAoB;AAClE,UAAIC,SAAJ,EAAe;AACbR,QAAAA,UAAU,CAAC;AAAE5B,UAAAA,KAAK,EAAE;AAAT,SAAD,CAAV;AACD;;AACDmC,MAAAA,IAAI;AACL,KALD,EA1Bc,CAgCd;;AACAvC,IAAAA,MAAM,CAACkD,OAAP,GAjCc,CAkCd;;AACAlD,IAAAA,MAAM,CAAC0C,eAAP;AACA,WAAO,YAAM;AACXF,MAAAA,SAAS,GAAG,KAAZ;AACAxC,MAAAA,MAAM,CAACmD,GAAP,CAAWV,OAAX;AACD,KAHD;AAID,GAxCD,EAwCG,EAxCH;;AA0CA,MAAIjB,KAAJ,EAAW;AACT,WAAOU,WAAW,EAAlB;AACD,GAFD,MAEO,IAAID,aAAa,CAAC3B,UAAd,IAA4ByB,OAAO,CAAC3B,KAAxC,EAA+C;AACpD,QAAI6B,aAAa,CAAC1B,WAAlB,EAA+B;AAC7B,UAAI0B,aAAa,CAAC1B,WAAd,CAA0B6C,KAA1B,CAAgC9B,IAAhC,KAAyCS,OAAO,CAAC3B,KAAR,CAAcgD,KAAd,CAAoB9B,IAAjE,EAAuE;AACrE,eAAOY,WAAW,EAAlB;AACD;AACF,KAJD,MAIO;AACLD,MAAAA,aAAa,CAAC1B,WAAd,GAA4BwB,OAAO,CAAC3B,KAApC;AACA,aAAO8B,WAAW,EAAlB;AACD;AACF,GATM,MASA,IAAIH,OAAO,CAAC3B,KAAZ,EAAmB;AACxB,WAAO8B,WAAW,EAAlB;AACD;;AACD,SAAO,IAAP;AACD;;AACM,SAASmB,IAAT,QAA8B;AAAA,MAAd/B,IAAc,SAAdA,IAAc;AACnCd,EAAAA,SAAS,CAACc,IAAD,CAAT;AACA,SAAO,IAAP;AACD;;AACM,SAASgC,MAAT,QAAiD;AAAA,MAA/B/B,QAA+B,SAA/BA,QAA+B;;AAAA,kBAC5B,qBAAwB,KAAxB,CAD4B;AAAA;AAAA,MAC/CnB,KAD+C;AAAA,MACxCmD,QADwC;;AAEtD,wBAAU,YAAM;AACd,aAASC,aAAT,CAAuBpD,KAAvB,EAAqC;AACnCmD,MAAAA,QAAQ,CAACnD,KAAD,CAAR;AACD;;AACDI,IAAAA,SAAS,GAAGmC,EAAZ,CAAe,GAAf,EAAoBa,aAApB;AACA,WAAO,YAAM;AACXhD,MAAAA,SAAS,GAAG2C,GAAZ,CAAgBK,aAAhB;AACD,KAFD;AAGD,GARD,EAQG,EARH;AASA,sBACE,gCAAC,aAAD,CAAe,QAAf;AACE,IAAA,KAAK,EAAE;AAAEjD,MAAAA,WAAW,EAAE,KAAf;AAAsBD,MAAAA,UAAU,EAAE;AAAlC,KADT;AAEE,IAAA,GAAG,EAAEF,KAAK,GAAGA,KAAK,CAACqD,GAAT,mBAAwB,IAAIC,IAAJ,GAAWC,OAAX,EAAxB;AAFZ,KAIGpC,QAJH,CADF;AAQD;;AACM,SAASqC,QAAT,QAA2D;AAAA,MAAvCrC,QAAuC,SAAvCA,QAAuC;AAAA,MAA7BsC,KAA6B,SAA7BA,KAA6B;AAChE,MAAMzD,KAAK,GAAG0D,WAAW,CAACD,KAAD,CAAzB;;AAEA,MAAIzD,KAAJ,EAAW;AACT,wBAAO,gCAAC,OAAD,CAAS,QAAT;AAAkB,MAAA,KAAK,EAAE;AAAEA,QAAAA,KAAK,EAALA;AAAF;AAAzB,OAAqCmB,QAArC,CAAP;AACD;;AACD,SAAO,IAAP;AACD;;AACM,SAASwC,QAAT,QAAkC;AAAA,MAAdzC,IAAc,SAAdA,IAAc;AACvC,wBAAU,YAAM;AACdd,IAAAA,SAAS,GAAGwD,QAAZ,CAAqB1C,IAArB;AACD,GAFD,EAEG,EAFH;AAGA,SAAO,IAAP;AACD,C,CAED;;;AACO,SAAS2C,SAAT,GAAoC;AACzC,SAAO,uBAAWhE,OAAX,CAAP;AACD;;AACM,SAASiE,WAAT,GAA8B;AACnC,SAAO1D,SAAS,GAAG2D,kBAAZ,EAAP;AACD,C,CAED;;;AACA,SAASL,WAAT,CAAqBD,KAArB,EAAoE;AAAA,mBACxC,qBAAwB,KAAxB,CADwC;AAAA;AAAA,MAC3DzD,KAD2D;AAAA,MACpDmD,QADoD;;AAElE,MAAMd,OAAO,GAAG,mBAAO,UAACrC,KAAD,EAA0B;AAC/CmD,IAAAA,QAAQ,CAACnD,KAAD,CAAR;AACAU,IAAAA,QAAQ,CAAC;AAAA,aAAMN,SAAS,GAAGkC,eAAZ,EAAN;AAAA,KAAD,CAAR;AACD,GAHe,CAAhB;AAKA,wBAAU,YAAM;AACd;AACA,QAAM1C,MAAM,GAAGQ,SAAS,EAAxB;AACAR,IAAAA,MAAM,CAACoE,QAAP,CAAgB3B,OAAO,CAAC4B,OAAxB,EAAiCR,KAAjC;AACA7D,IAAAA,MAAM,CAACiD,YAAP,CAAoB,eAApB,EAAqC,UAACV,IAAD,EAAoB;AACvDgB,MAAAA,QAAQ,CAAC,KAAD,CAAR;AACAhB,MAAAA,IAAI;AACL,KAHD;AAIAvC,IAAAA,MAAM,CAACkD,OAAP;AACAlD,IAAAA,MAAM,CAAC0C,eAAP;AACA,WAAO,YAAM;AACX1C,MAAAA,MAAM,CAACmD,GAAP,CAAWV,OAAO,CAAC4B,OAAnB;AACD,KAFD;AAGD,GAbD,EAaG,EAbH;AAeA,SAAOjE,KAAP;AACD;;AAED,IAAMkE,GAAG,GAAG;AACV9D,EAAAA,SAAS,EAATA,SADU;AAEVS,EAAAA,eAAe,EAAfA,eAFU;AAGVC,EAAAA,KAAK,EAALA,KAHU;AAIVG,EAAAA,KAAK,EAALA,KAJU;AAKVgC,EAAAA,IAAI,EAAJA,IALU;AAMVC,EAAAA,MAAM,EAANA,MANU;AAOVM,EAAAA,QAAQ,EAARA,QAPU;AAQVG,EAAAA,QAAQ,EAARA,QARU;AASVE,EAAAA,SAAS,EAATA,SATU;AAUVC,EAAAA,WAAW,EAAXA;AAVU,CAAZ;eAaeI,G","sourcesContent":["import React, { useRef, useEffect, useState, useContext, useReducer } from \"react\";\nimport Navigo, { Match as NavigoMatch, RouteHooks as NavigoHooks, Route as NavigoRoute } from \"navigo\";\n// import Navigo, { Match, RouteHooks } from \"../../navigo\";\n\nimport { RouteProps, Path, NotFoundRouteProps, NavigoSwitchContextType, NavigoRouting } from \"../index.d\";\n\nlet router: Navigo | undefined;\nlet Context = React.createContext({ match: false } as NavigoRouting);\nlet SwitchContext = React.createContext({ isInSwitch: false, switchMatch: false } as NavigoSwitchContextType);\n\n// types\nexport type Match = NavigoMatch;\nexport type RouteHooks = NavigoHooks;\n\nexport function getRouter(root?: string): Navigo {\n  if (router) {\n    return router;\n  }\n  router = new Navigo(root || \"/\", { strategy: \"ALL\", noMatchWarning: true });\n  // @ts-ignore\n  window.router = router;\n  return router;\n}\nfunction nextTick(callback: Function) {\n  setTimeout(() => callback(), 0);\n}\n\n// utils\nexport function configureRouter(root: string) {\n  return getRouter(root);\n}\nexport function reset() {\n  if (router) {\n    router.destroy();\n    router = undefined;\n  }\n}\n\n// components\nexport function Route({ path, children, loose, before, after, already, leave }: RouteProps) {\n  const [context, setContext] = useReducer((state: NavigoRouting, action: NavigoRouting) => ({ ...state, ...action }), {\n    match: false,\n  });\n  const switchContext = useContext(SwitchContext);\n  const renderChild = () => <Context.Provider value={context}>{children}</Context.Provider>;\n  const noneBlockingHook = (func: Function) => (match: Match) => {\n    func((result: any) => {\n      if (typeof result === \"object\" && result !== null) {\n        setContext(result);\n      }\n    }, match);\n  };\n  const blockingHook = (func: Function) => (done: Function, match: Match) => {\n    func((result: any) => {\n      if (typeof result === \"boolean\") {\n        done(result);\n      } else if (typeof result === \"object\" && result !== null) {\n        setContext(result);\n      }\n    }, match);\n  };\n\n  useEffect(() => {\n    let isMounted = true;\n    const router = getRouter();\n    const handler = (match: false | Match) => {\n      if (isMounted) {\n        setContext({ match });\n      }\n      nextTick(() => getRouter().updatePageLinks());\n    };\n    // creating the route\n    router.on(path, handler);\n    const navigoRoute = router.getRoute(handler);\n    // hooking\n    if (before) {\n      router.addBeforeHook(navigoRoute as NavigoRoute, blockingHook(before));\n    }\n    if (after) {\n      router.addAfterHook(navigoRoute as NavigoRoute, noneBlockingHook(after));\n    }\n    if (already) {\n      router.addAlreadyHook(navigoRoute as NavigoRoute, noneBlockingHook(already));\n    }\n    if (leave) {\n      router.addLeaveHook(navigoRoute as NavigoRoute, blockingHook(leave));\n    }\n    // adding the service leave hook\n    router.addLeaveHook(navigoRoute as NavigoRoute, (done: Function) => {\n      if (isMounted) {\n        setContext({ match: false });\n      }\n      done();\n    });\n    // initial resolving\n    router.resolve();\n    // initial data-navigo set up\n    router.updatePageLinks();\n    return () => {\n      isMounted = false;\n      router.off(handler);\n    };\n  }, []);\n\n  if (loose) {\n    return renderChild();\n  } else if (switchContext.isInSwitch && context.match) {\n    if (switchContext.switchMatch) {\n      if (switchContext.switchMatch.route.path === context.match.route.path) {\n        return renderChild();\n      }\n    } else {\n      switchContext.switchMatch = context.match;\n      return renderChild();\n    }\n  } else if (context.match) {\n    return renderChild();\n  }\n  return null;\n}\nexport function Base({ path }: Path) {\n  getRouter(path);\n  return null;\n}\nexport function Switch({ children }: { children: any }) {\n  const [match, setMatch] = useState<Match | false>(false);\n  useEffect(() => {\n    function switchHandler(match: Match) {\n      setMatch(match);\n    }\n    getRouter().on(\"*\", switchHandler);\n    return () => {\n      getRouter().off(switchHandler);\n    };\n  }, []);\n  return (\n    <SwitchContext.Provider\n      value={{ switchMatch: false, isInSwitch: true }}\n      key={match ? match.url : `switch${new Date().getTime()}`}\n    >\n      {children}\n    </SwitchContext.Provider>\n  );\n}\nexport function NotFound({ children, hooks }: NotFoundRouteProps) {\n  const match = useNotFound(hooks);\n\n  if (match) {\n    return <Context.Provider value={{ match }}>{children}</Context.Provider>;\n  }\n  return null;\n}\nexport function Redirect({ path }: Path) {\n  useEffect(() => {\n    getRouter().navigate(path);\n  }, []);\n  return null;\n}\n\n// hooks\nexport function useNavigo(): NavigoRouting {\n  return useContext(Context);\n}\nexport function useLocation(): Match {\n  return getRouter().getCurrentLocation();\n}\n\n// internal hooks\nfunction useNotFound(hooks?: RouteHooks | undefined): false | Match {\n  const [match, setMatch] = useState<false | Match>(false);\n  const handler = useRef((match: false | Match) => {\n    setMatch(match);\n    nextTick(() => getRouter().updatePageLinks());\n  });\n\n  useEffect(() => {\n    // @ts-ignore\n    const router = getRouter();\n    router.notFound(handler.current, hooks);\n    router.addLeaveHook(\"__NOT_FOUND__\", (done: Function) => {\n      setMatch(false);\n      done();\n    });\n    router.resolve();\n    router.updatePageLinks();\n    return () => {\n      router.off(handler.current);\n    };\n  }, []);\n\n  return match;\n}\n\nconst API = {\n  getRouter,\n  configureRouter,\n  reset,\n  Route,\n  Base,\n  Switch,\n  NotFound,\n  Redirect,\n  useNavigo,\n  useLocation,\n};\n\nexport default API;\n"],"file":"NavigoReact.js"}